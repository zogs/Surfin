<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JavaScript implementation of Craig Reynoldsâ€™s path-following algorithm</title>
</head>
<body  onload="loaded()" style="margin:0;padding:0;overflow:hidden;">

  <canvas id="canvas"  width="1500" height="600" class="viewport" style="background: #eee;"></canvas>

	<script src=" http://code.createjs.com/createjs-2013.12.12.min.js"></script>
  <script src="lib/gl-matrix-min.js"></script>
  <script type="text/javascript">
  		var stage;

		window.loaded = function() {

			stage = new createjs.Stage('canvas');

			queue = new createjs.LoadQueue();
			queue.addEventListener('complete',initialize);
			queue.loadManifest([
				{id:'bg_paradize',src:'assets/img/bkg/paradize.jpg'},
				{id:'wave',src:'assets/img/waves/wave1.jpg'},
				{id:'surfer_W',src:'assets/img/surfer/W.png'},
				{id:'surfer_NW',src:'assets/img/surfer/NW.png'},
				{id:'surfer_N',src:'assets/img/surfer/N.png'},
				{id:'surfer_NE',src:'assets/img/surfer/NE.png'},
				{id:'surfer_E',src:'assets/img/surfer/E.png'},
				{id:'surfer_SE',src:'assets/img/surfer/SE.png'},
				{id:'surfer_S',src:'assets/img/surfer/S.png'},
				{id:'surfer_SW',src:'assets/img/surfer/SW.png'}
				]);
		}

		window.initialize = function() {
			console.log('initialize');

			//Globals
			_stageWidth = stage.canvas.width;
			_stageHeight = stage.canvas.height;
			MOUSE_X = _stageWidth / 2;
			_mouseY = _stageHeight / 2;
			_mousePoints = [];

			var background = new createjs.Bitmap(queue.getResult('bg_paradize'));
			stage.addChild(background);

			//init onEnterFrame
			createjs.Ticker.addEventListener('tick',tick);

			vanish = new createjs.Shape();
				vanish.graphics.beginFill('yellow').drawCircle(0,0,20);
				vanish.x = 200;
				vanish.y = 100;
				vanish.location = vec2.fromValues(200,100);
				stage.addChild(vanish); 

			//init Mouse move 
			stage.addEventListener('stagemousemove',onMouseMove);

			gravity = vec2.fromValues(0,1);

			waveSuction = vec2.fromValues(-10,-5);

			surfer = new createjs.Container();
			surfer.x = 750;
			surfer.y = 250;
			surfer.location = vec2.fromValues(750,250);	
			surfer.locations = [surfer.location];	
			surfer.velocity = vec2.create();
			surfer.velocities = [surfer.velocity];	
			surfer.speed = 0;
			surfer.skill = vec2.fromValues(1,1);
			var bitmap = new createjs.Bitmap(queue.getResult('surfer_E'));
			bitmap.x = bitmap.y = -40;	
			surfer.addChild(bitmap);
			stage.addChild(surfer);

			surfer.velocity = vec2.create();

		}
		window.OnWave= function() {

			//vec2.add(surfer.location,surfer.location,waveSuction);

			var m = vec2.fromValues(MOUSE_X,_mouseY);
			vec2.lerp(surfer.location,surfer.location,m,0.05);	
			
			vec2.lerp(surfer.location,surfer.location,vanish.location,0.05);

			//vec2.add(surfer.location,surfer.location,f);

			

			

			// var v = vec2.fromValues(vanish.x,vanish.y);
			// var m = vec2.fromValues(MOUSE_X,_mouseY);
			// vec2.lerp(surfer.location,surfer.location,v,0.1);
			// vec2.lerp(surfer.location,surfer.location,m,0.1);	

		}
		window.OnAir = function() {

			vec2.add(surfer.location,surfer.location,surfer.velocity);
			vec2.add(surfer.location,surfer.location,gravity);
		}

		window.moveSurfer = function() {

			if(surfer.y >= 120){
				OnWave();
			}
			else {
				OnAir();
			}			

			//vec2.add(surfer.location,surfer.location,surfer.velocity
			surfer.x = surfer.location[0];
			surfer.y = surfer.location[1];

			//save locations		
			surfer.locations.unshift(vec2.clone(surfer.location));
			surfer.locations = surfer.locations.slice(0,10);

			//save velocities
			vec2.sub(surfer.velocity,surfer.locations[0],surfer.locations[1]);	
			surfer.velocities.unshift(vec2.clone(surfer.velocity));
			surfer.velocities = surfer.velocities.slice(0,10);

			//save speed
			surfer.speed = vec2.dist(surfer.locations[0],surfer.locations[1]);			
						
			

		}

		window.tick = function() {

			moveSurfer();
			stage.update();
		}

		window.onMouseMove= function(e) {

			MOUSE_X = e.stageX;
			_mouseY = e.stageY;

			var pt = new createjs.Point(MOUSE_X,_mouseY);
			_mousePoints.unshift(pt);
			_mousePoints = _mousePoints.slice(0,300);

		}

  </script>
</body>
</html>
